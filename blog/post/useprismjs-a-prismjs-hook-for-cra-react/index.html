<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link href="/favicon.ico" rel="icon"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="#000000" name="theme-color"><meta content="Web site created using create-react-app" name="description"><link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet"><link href="/logo192.png" rel="apple-touch-icon"><link href="/manifest.json" rel="manifest"><script type="text/javascript">!function(i){if(i.search){var a={};i.search.slice(1).split("&").forEach((function(i){var l=i.split("=");a[l[0]]=l.slice(1).join("=").replace(/~and~/g,"&")})),void 0!==a.p&&window.history.replaceState(null,null,i.pathname.slice(0,-1)+(a.p||"")+(a.q?"?"+a.q:"")+i.hash)}}(window.location)</script><style>@font-face{font-family:'Cascadia Code PL';src:url(/CascadiaCodePL.woff2)}</style><title>Nathan Smith - usePrismjs: A prismjs hook for CRA & React</title><link href="/static/css/2.ca3edc6c.chunk.css" rel="stylesheet"><link href="/static/css/main.4af7e5a3.chunk.css" rel="stylesheet"><link href="https://fonts.googleapis.com" rel="preconnect"><style data-emotion="css-global">html{box-sizing:border-box;color:#333;font-family:Lato,sans-serif;font-size:16px}h1,h2,h3,h4,p{margin:0}h1 .muted,h2 .muted,h3 .muted,h4 .muted,p .muted{color:#707070}h1{font-size:2em;font-weight:300;line-height:1.61}h2{font-size:1.5em;font-weight:300;line-height:1.61}h3{font-size:1.3em;font-weight:400;line-height:1.61;margin-bottom:8px}h4{font-size:1.15em;font-weight:400;line-height:1.61;margin-bottom:8px}p{font-size:1em;font-weight:400;line-height:1.61;margin-bottom:16px}ol>li,ul>li{margin-bottom:8px}*,::after,::before{box-sizing:inherit}</style><style data-emotion="css-global">body{background-color:#e7ecef}</style><style data-emotion="css">.css-7s135m{background-color:#377771;color:#fff;padding:0 16px;height:56px;display:flex;-webkit-box-align:center;align-items:center}.css-7s135m .spacer{cursor:initial;-webkit-box-flex:1;flex-grow:1}.css-3nv3p6{font-size:1.5em;font-weight:300;text-decoration:none}.css-3nv3p6,.css-3nv3p6:active,.css-3nv3p6:hover,.css-3nv3p6:visited{color:#fff}.css-3nv3p6:hover{text-decoration:underline}.css-yy8q92{width:24px;height:24px;fill:#fff;cursor:pointer}.css-1tkhywd{height:100%;width:100%;position:fixed;top:0;background-color:rgba(0,0,0,.2);opacity:0;display:none}.css-1tkhywd.appear{display:block}.css-1tkhywd.appear .content{transform:translateX(100%)}.css-1tkhywd.appear-active{display:block;opacity:1;transition:opacity .3s ease-in-out 0s}.css-1tkhywd.appear-active .content{transform:translateX(0);transition:transform .3s ease-in-out 0s}.css-1tkhywd.enter{display:block}.css-1tkhywd.enter .content{transform:translateX(100%)}.css-1tkhywd.enter-active{display:block;opacity:1;transition:opacity .3s ease-in-out 0s}.css-1tkhywd.enter-active .content{transform:translateX(0);transition:transform .3s ease-in-out 0s}.css-1tkhywd.enter-done{display:block;opacity:1}.css-1tkhywd.enter-done .content{transform:translateX(0)}.css-1tkhywd.exit{display:block;opacity:1}.css-1tkhywd.exit .content{transform:translateX(0)}.css-1tkhywd.exit-active{display:block;opacity:0;transition:opacity .3s ease-in-out 0s}.css-1tkhywd.exit-active .content{transform:translateX(100%);transition:transform .3s ease-in-out 0s}.css-1tkhywd.exit-done .content{transform:translateX(100%)}.css-1tkhywd .content{width:75%;height:100%;transform:translateX(100%);background-color:#fff;float:right;box-shadow:rgba(0,0,0,.2) 0 2px 4px -1px,rgba(0,0,0,.14) 0 4px 5px 0,rgba(0,0,0,.12) 0 1px 10px 0}.css-1w9bo4g{display:flex;-webkit-box-pack:end;justify-content:flex-end;-webkit-box-align:center;align-items:center;height:56px;padding-right:16px;padding-left:16px}.css-1sy3o6m{width:24px;height:24px;fill:#333;cursor:pointer}.css-1racmj3{height:32px;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:end;justify-content:flex-end;-webkit-box-flex:1;flex-grow:1}.css-1xp9bj7{padding:2px;display:none;background-color:#fff;height:100%;border-radius:4px;margin-right:8px}.css-1xp9bj7.enter{display:flex;width:0}.css-1xp9bj7.enter-active{display:flex;transition:width .2s ease-in-out 0s;width:100%}.css-1xp9bj7.enter-done{display:flex;width:100%}.css-1xp9bj7.exit{display:flex;width:100%}.css-1xp9bj7.exit-active{display:flex;transition:width .2s ease-in-out 0s;width:0}.css-1xp9bj7.enter-active{border:2px solid #4ce0b3}.css-1xp9bj7.enter-done{border:2px solid #4ce0b3}.css-1xp9bj7.exit{border:2px solid #4ce0b3}.css-1xp9bj7.exit-active{border:2px solid #4ce0b3}.css-8ixyqt{outline:0;border:none;background-color:transparent;-webkit-box-flex:1;flex-grow:1}.css-1fbv98y{display:block;width:24px;height:24px;cursor:pointer;fill:#333;flex-shrink:0}.css-1mysl4o{font-size:1.15em;height:56px;display:flex;-webkit-box-align:center;align-items:center;padding-left:16px}.css-es40ty{font-size:1.15em;height:56px;display:flex;-webkit-box-align:center;align-items:center;padding-left:32px;cursor:pointer}.css-es40ty:hover{background-color:#4ce0b3}.css-90qeus{font-size:1.15em;height:56px;display:flex;-webkit-box-align:center;align-items:center;padding-left:16px;cursor:pointer}.css-90qeus:hover{background-color:#4ce0b3}.css-1koktpm{margin-bottom:16px;max-width:900px;margin-left:auto;margin-right:auto}.css-16mez8{display:flex;margin-top:12px;margin-bottom:4px}.css-16mez8 .tag-icon{width:16px;height:16px;fill:#999}.css-16mez8 .tag-link{color:#707070;text-decoration:none;margin-left:4px}.css-16mez8 .tag-link:hover{text-decoration:underline}.css-pyf139{font-size:.8em;font-weight:400}</style><link href="https://fonts.gstatic.com" rel="preconnect"><link href="https://api.buttercms.com" rel="preconnect"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div><header class="css-7s135m"><a href="/" class="css-3nv3p6"><span>Nathan Smith</span></a><div class="spacer"></div><svg class="css-yy8q92" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path></svg></header><div class="css-1koktpm"><h1 class="">usePrismjs: A prismjs hook for CRA & React</h1><h4>May 20, 2020, 4:14 PMâ€”<a href="/blog/category/react">React</a></h4><div class="line-numbers"><h2>What is it?</h2><p><a href="https://prismjs.com/index.html" rel="follow">Prismjs</a> is a powerful little javascript to add syntax highlighting to <code>&lt;pre></code> and <code>&lt;code></code> blocks, but it hasn't kept up with a JavaScript framework-using, module-bundling world. There aren't many docs around how to use it with the npm package, and most want you to use a babel plugin, and I'm not about to eject my CRA app just for syntax highlighting. Additionally, the html I'm highlighting comes from a CMS, so it has to work with any incoming HTML. After struggling through it, I came up with this hook, which is being used on this page. How meta!</p><h2>Using the hook</h2><h3>1. Install prismjs</h3><p>The easy part. Just install prismjs and its types (if you're using TypeScript):</p><pre class="language-undefined line-numbers"><code class="language-undefined">npm install --save prismjs
npm install --save-dev @types/prismjs<span class="line-numbers-rows" aria-hidden="true"><span style="height:24px"></span><span style="height:24px"></span></span><span class="line-numbers-sizer" style="display:none"></span></code></pre><h3>2. Create the usePrismjs hook</h3><pre class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Prismjs <span class="token keyword">from</span> <span class="token string">'prismjs'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'prismjs/themes/prism.css'</span><span class="token punctuation">;</span> <span class="token comment">/* or your own custom theme */</span>
<span class="token keyword">import</span> <span class="token string">'prismjs/plugins/line-numbers/prism-line-numbers.css'</span> <span class="token comment">/* add plugin css */</span>

<span class="token comment">// Require all needed languages</span>
<span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'prismjs/components/prism-typescript'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'prismjs/components/prism-jsx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'prismjs/components/prism-tsx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Require all needed plugins</span>
<span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'prismjs/plugins/line-numbers/prism-line-numbers'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> usePrismjs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">T</span></span> <span class="token attr-name">extends</span> <span class="token attr-name">HTMLElement</span><span class="token punctuation">></span></span><span class="token plain-text">(
  target: React.RefObject</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">T</span></span><span class="token punctuation">></span></span><span class="token plain-text">,
  plugins: string[] = []
) </span><span class="token punctuation">{</span>
  React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>plugins<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">.</span>current<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">...</span>plugins<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// Highlight all &lt;pre>&lt;code>...&lt;/code>&lt;/pre> blocks contained by this element</span>
      Prismjs<span class="token punctuation">.</span><span class="token function">highlightAllUnder</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>target<span class="token punctuation">,</span> plugins<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token plain-text">
</span><span class="line-numbers-rows" aria-hidden="true"><span style="height:24px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:48px"></span><span style="height:48px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:48px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:48px"></span><span style="height:24px"></span><span style="height:48px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:48px"></span><span style="height:24px"></span><span style="height:48px"></span><span style="height:48px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:24px"></span></span><span class="line-numbers-sizer" style="display:none"></span></code></pre><p>Customize to your plugin/language needs.</p><h3>3. Use the hook</h3><pre class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BlogPost <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../types/cms'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> usePrismjs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../hooks/usePrismjs'</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">PostProps</span> <span class="token punctuation">{</span>
  post<span class="token operator">:</span> BlogPost<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> Post<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">PostProps</span></span><span class="token punctuation">></span></span><span class="token plain-text"> = props => </span><span class="token punctuation">{</span>
  <span class="token comment">// body is string with blog post html, including code</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> body<span class="token punctuation">,</span> title<span class="token punctuation">,</span> published <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">.</span>post<span class="token punctuation">;</span>
  <span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>published<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> bodyRef <span class="token operator">=</span> React<span class="token punctuation">.</span>useRef<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HTMLDivElement</span></span><span class="token punctuation">></span></span><span class="token plain-text">(null);
  usePrismjs(bodyRef, ['line-numbers']);

  return (
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>published<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>bodyRef<span class="token punctuation">}</span></span> <span class="token attr-name">dangerouslySetInnerHTML</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> __html<span class="token operator">:</span> body <span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
  );
};
</span><span class="line-numbers-rows" aria-hidden="true"><span style="height:24px"></span><span style="height:24px"></span><span style="height:48px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:48px"></span><span style="height:48px"></span><span style="height:48px"></span><span style="height:24px"></span><span style="height:48px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:48px"></span><span style="height:24px"></span><span style="height:24px"></span><span style="height:24px"></span></span><span class="line-numbers-sizer" style="display:none"></span></code></pre><h2>Explanations</h2><p>There are a few obvious questions I see:</p><h3>Why add the class directly to the dom?</h3><p>Because prismjs works directly on the dom; the <code>highlightAllUnder</code> method expects a real DOM element, so we have to give it one.</p><h3>Why not conditionally require plugins and languages like the babel plugin?</h3><p>This might work, but it would also mean conditionally requiring plugin css.</p></div><div class="css-16mez8"><svg class="tag-icon" viewBox="0 0 20 20" xml:space="http://www.w3.org/2000/svg"><path d="M0 10V2l2-2h8l10 10-10 10L0 10zm4.5-4a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"></path></svg><a href="/blog/tag/hooks" class="tag-link"><p class="css-pyf139">hooks</p></a></div><p class="">Previous:Â <a href="/blog/post/publishing-a-dev-and-production-cra-app-to-gh-pages">Publishing a Dev and Production CRA App to GH Pages</a></p></div></div></div><script>!function(e){function t(t){for(var n,i,l=t[0],f=t[1],a=t[2],c=0,s=[];c<l.length;c++)i=l[c],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&s.push(o[i][0]),o[i]=0;for(n in f)Object.prototype.hasOwnProperty.call(f,n)&&(e[n]=f[n]);for(p&&p(t);s.length;)s.shift()();return u.push.apply(u,a||[]),r()}function r(){for(var e,t=0;t<u.length;t++){for(var r=u[t],n=!0,l=1;l<r.length;l++){var f=r[l];0!==o[f]&&(n=!1)}n&&(u.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},o={1:0},u=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var l=this["webpackJsonpdev-site"]=this["webpackJsonpdev-site"]||[],f=l.push.bind(l);l.push=t,l=l.slice();for(var a=0;a<l.length;a++)t(l[a]);var p=f;r()}([])</script><script src="/static/js/2.963218c2.chunk.js"></script><script src="/static/js/main.1e1f8030.chunk.js"></script><div id="drawer-portal"><div class="shade css-1tkhywd"><div class="content"><div class="css-1w9bo4g"><svg class="css-1sy3o6m" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 8.586L2.929 1.515 1.515 2.929 8.586 10l-7.071 7.071 1.414 1.414L10 11.414l7.071 7.071 1.414-1.414L11.414 10l7.071-7.071-1.414-1.414L10 8.586z"></path></svg></div><div class="css-1w9bo4g"><div class="css-1racmj3"><div class="css-1xp9bj7"><input class="css-8ixyqt" tabindex="0" type="text"></div><svg class="css-1fbv98y" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.9 14.32a8 8 0 1 1 1.41-1.41l5.35 5.33-1.42 1.42-5.33-5.34zM8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12z"></path></svg></div></div><div class="css-1mysl4o">Projects</div><div class="css-es40ty">Alloy</div><div class="css-es40ty">Homebrewery Markdown Preview</div><div class="css-90qeus">About</div><div class="css-90qeus">Contact</div></div></div></div></body></html>