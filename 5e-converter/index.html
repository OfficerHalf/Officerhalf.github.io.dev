<!DOCTYPE html>
<html ng-app=pfTo5e>

<head>
    <title>5e Monster Converter</title>
    <script src=https://ajax.googleapis.com/ajax/libs/angularjs/1.4.2/angular.min.js></script>
    <script src=converter.js></script>
    <script src=fraction.js></script>
    <script src=dom-to-image.js></script>
    <script src=FileSaver.min.js></script>
    <script>
    var renderImage = function () {
    	domtoimage.toBlob(document.getElementsByClassName("content-wrap")[0])
    		.then(function (blob) {
    			window.saveAs(blob, '5eStats.png');
            });
    }
    </script>
    <link href="http://fonts.googleapis.com/css?family=Lora:700" rel=stylesheet type=text/css>
    <link href="http://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic,700italic" rel=stylesheet type=text/css>
    <link rel=stylesheet href=style.css>
</head>

<body ng-controller=MainCtrl>
    <div class=container>
        <div class=pf-stats>
            <div class=error ng-if=error>{{error}}</div>
            <textarea ng-model=pfStats ng-change=parseStats()></textarea>
            <div><a href=https://docs.google.com/document/d/15PDTkBoUBlAXVgzm9YCvRrMKTLKpCFyqwNVcoz05q9I target=_new>Conversion Rules</a> <span>Styling reference: <a href="http://valloric.github.io/statblock5e/" target=_new>Statblock5e</a></span>
            </div>
            <div>Last Updated: 8th April 2017</div>
            <div>
                <label>
                    <input type=checkbox ng-model=useCondensed ng-change=parseStats()> Use condensed Skills and Saving throws</label>
            </div>
            <div>
            	<button id="renderButton" onclick="renderImage()">Render to Image</button>
            </div>
        </div>
        <div class="stat-block ng-cloak">
            <div class=bar></div>
            <div class="content-wrap", id="5eStats">
                <h1 ng-bind=stats.attr.name></h1>
                <h2><span ng-bind=capitalizeFirstLetter(stats.attr.size)></span> <span ng-bind=stats.attr.type></span>, <span ng-bind=stats.attr.alignment></span></h2>
                <hr>
                <div class=top-stats>
                    <div>
                        <h4>Armor Class</h4>&nbsp;<span ng-bind=stats.attr.ac.ac></span> <span ng-if=stats.attr.ac.note>(<span ng-bind=stats.attr.ac.note></span>)</span>
                    </div>
                    <div>
                        <h4>Hit Points</h4>&nbsp;<span ng-bind=stats.attr.hpAverage></span> (<span ng-repeat="(HDsize, numHD) in stats.attr.hd"><span ng-if="numHD > 0"><span ng-bind=numHD></span>d<span ng-bind=HDsize></span></span>
                        </span><span ng-if=stats.attr.hpFromCon>&nbsp;<span ng-bind="stats.attr.hpFromCon | arithmeticSymbol : true"></span></span>)</div>
                    <div>
                        <h4>Speed</h4>&nbsp;<span ng-repeat="(speed, speedValue) in stats.attr.speed"><span ng-if="speed != 'speed'"><span ng-bind=speed></span>&nbsp;</span><span ng-bind=speedValue></span><span>&nbsp;ft.</span>{{$last ? '' : ', '}}</span>
                    </div>
                    <hr>
                    <div>
                        <div class=ability-wrapper ng-repeat="ability in stats.attr.abilities">
                            <h4 ng-bind=ability.shortName.toUpperCase()></h4>
                            <div><span ng-bind=ability.score></span> (<span ng-bind="ability.mod | arithmeticSymbol"></span>)</div>
                        </div>
                    </div>
                    <hr>
                    <div ng-if=stats.saves>
                        <h4>Saving Throws</h4>&nbsp;<span><span ng-repeat="(saveKey,saveMod) in stats.saves"><span class=skill-name ng-bind=capitalizeFirstLetter(saveKey)></span> <span ng-bind="saveMod | arithmeticSymbol"></span>{{$last ? '' : ', '}}</span>
                        </span>
                    </div>
                    <div ng-if=stats.skills>
                        <h4>Skills</h4>&nbsp;<span><span ng-repeat="(skillKey,skillObj) in stats.skills"><span class=skill-name ng-bind=capitalizeFirstLetter(skillKey)></span> <span><span ng-if="skillObj.proficiency == 'expertise'" ng-bind="stats.attr.pb*2 + stats.attr.abilities[skillObj.ability].mod | arithmeticSymbol"></span><span ng-if="skillObj.proficiency == 'proficient'" ng-bind="stats.attr.pb + stats.attr.abilities[skillObj.ability].mod | arithmeticSymbol"></span></span>{{$last ? '' : ', '}}</span>
                        </span>
                    </div>
                    <div ng-if=stats.damageResistances>
                        <h4>Damage Resistances</h4>&nbsp;{{stats.damageResistances}}</div>
                    <div ng-if=stats.conditionImmunities>
                        <h4>Condition Immunities</h4>&nbsp;{{stats.conditionImmunities}}</div>
                    <div>
                        <h4>Senses</h4>&nbsp;<span ng-repeat="(sense,senseVal) in stats.attr.senses | orderBy: sense"><span ng-bind=sense></span>&nbsp;<span ng-bind=senseVal></span>&nbsp;ft.,&nbsp;</span><span>passive Perception <span ng-if="stats.skills.perception && stats.skills.perception.proficiency == 'expertise'" ng-bind="10 + stats.attr.pb*2 + stats.attr.abilities.wisdom.mod"></span><span ng-if="stats.skills.perception && stats.skills.perception.proficiency == 'proficient'" ng-bind="10 + stats.attr.pb + stats.attr.abilities.wisdom.mod"></span><span ng-if=!stats.skills.perception ng-bind="10 + stats.attr.abilities.wisdom.mod"></span></span>
                    </div>
                    <div ng-if=stats.attr.languages>
                        <h4>Languages</h4>&nbsp;<span ng-bind=stats.attr.languages></span>
                    </div>
                    <div>
                        <h4>Challenge</h4>&nbsp;<span ng-bind=stats.attr.cr.display></span> <span>(<span ng-bind="stats.attr.xp | number"></span> XP)</span>
                    </div>
                </div>
                <hr>
                <div class=properties-block>
                    <div class=trait ng-repeat="trait in stats.traits">
                        <h4><span ng-bind=trait.name></span>.</h4>&nbsp;<span ng-bind=trait.description></span>.</div>
                    <div ng-if=stats.spells>
                        <h4>Spellcasting.</h4>&nbsp;<span>The <span ng-bind=stats.attr.nameNoPreWords.toLowerCase()></span> is a <span ng-bind="stats.attr.CL | ordinalSuffix"></span> level spellcaster. Its spellcasting ability is <span class=casting-stat ng-bind=stats.attr.castingStat></span> (spell save DC <span ng-bind=stats.attr.saveDCs[stats.attr.castingStat]></span>, <span ng-bind="stats.attr.spellsToHit[stats.attr.castingStat] | arithmeticSymbol"></span> to hit with spell attacks). The <span ng-bind=stats.attr.nameNoPreWords.toLowerCase()></span> can cast the following spells:</span>
                        <div class=spells-wrap>
                            <div class=spells ng-repeat="(levelKey, levelValue) in stats.spells" ng-if="levelValue.spells.length > 0">
                                <div><span><span ng-if="levelKey == 0">Cantrip (at will)</span><span ng-if="levelKey > 0"><span ng-bind=levelKey></span> level (<span ng-bind="levelValue.slots || 1"></span> slot<span ng-if="levelValue.slots > 1">s</span>)</span>:</span> <span class=italic ng-bind="levelValue.spells.join(', ')"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <h3>Actions</h3>
                    <div class=multiattack ng-if="stats.multiattack.totalAttacks > 1">
                        <h4>Multiattack.</h4>&nbsp;<span>The <span ng-bind=stats.attr.nameNoPreWords.toLowerCase()></span> makes</span> <span ng-if="stats.multiattack.numOfMultiattackAttacks > 1 && !stats.multiattack.allAreOr"><span ng-bind=numberToWord(stats.multiattack.totalAttacks)></span> attacks:</span> <span ng-repeat="attack in stats.multiattack.attacks track by $index"><span ng-if="$index != 0">&nbsp;<span ng-bind=attack.addToMultiattack></span></span> <span><span ng-bind="numberToWord(attack.number || 1)"></span> <span ng-if="stats.multiattack.allAreOr || stats.multiattack.numOfMultiattackAttacks == 1">attack<span ng-if="attack.number > 1">s</span></span> with its <span ng-bind=attack.name></span></span>
                        </span>.</div>
                    <div class=attack ng-repeat="attack in stats.attacks">
                        <h4><span ng-bind=attack.name></span>.</h4>&nbsp;<span class=italic><span ng-if=!attack.thrown ng-bind=capitalizeFirstLetter(attack.type)></span><span ng-if=attack.thrown>Melee or Ranged</span> Weapon Attack:</span> <span><span ng-bind="(attack.toHit + stats.attr.pb) | arithmeticSymbol"></span> to hit,</span> <span ng-if="attack.type == 'melee' || attack.thrown">reach <span ng-bind=stats.attr.reach></span> ft.</span><span ng-if=attack.thrown>&nbsp;or&nbsp;</span><span ng-if="attack.type == 'ranged' || attack.thrown">range <span ng-bind=attack.range></span> ft.</span>, <span ng-bind=attack.target></span>. <span class=italic>Hit:</span> <span ng-bind=attack.averageDamage></span> <span>(<span ng-bind=attack.damageDice></span>d<span ng-bind=attack.damageDie></span><span ng-if=attack.damageBonus>&nbsp;<span ng-bind="attack.damageBonus | arithmeticSymbol : true"></span></span>)</span> <span><span ng-bind=attack.damageType></span>&nbsp;damage</span><span ng-if=attack.secondaryDamageDie>&nbsp;plus&nbsp;<span ng-bind=attack.averageSecondaryDamage></span><span>&nbsp;(<span ng-bind=attack.secondaryDamageDice></span>d<span ng-bind=attack.secondaryDamageDie></span><span ng-if=attack.secondaryDamageBonus ng-bind="attack.secondaryDamageBonus | arithmeticSymbol : true"></span>)</span>&nbsp;<span><span ng-bind=attack.secondaryDamageType></span>&nbsp;damage</span>
                        </span><span ng-if=attack.grab><span ng-if=attack.constrict>. The</span><span ng-if=!attack.constrict>, and the</span> target is grappled (escape DC <span ng-bind=stats.attr.saveDCs.strength></span>)<span ng-if=attack.constrict>&nbsp;if the <span ng-bind=stats.attr.name.toLowerCase()></span> isn't already constricting a creature, and the target is restrained until the grapple ends</span>
                        </span><span ng-if=attack.poison>, and the target must succeed on a DC <span ng-bind=stats.attr.saveDCs.constitution></span> Constitution saving throw<span ng-if="attack.poison.type == 'poisoned'">&nbsp;or become poisoned for <span ng-bind=attack.poison.duration></span></span><span ng-if="attack.poison.type == 'damage'">, taking <span ng-bind=attack.poison.damage></span> poison damage on a failed save, or half as much damage on a successful one. If the poison damage reduces the target to 0 hit points, the target is stable but poisoned for 1 hour, even after regaining hit points, and is paralyzed while poisoned in this way</span>
                        </span>. <span ng-if=attack.disease>If the target is a creature, it must succeed on a DC <span ng-bind=stats.attr.saveDCs.constitution></span> Constitution saving throw against disease or become <span ng-bind=attack.disease.effect></span> until the disease is cured. Every 24 hours that elapse, the target must repeat the saving throw, reducing its hit point maximum by 5 (1d10) on a failure. The disease is cured on a success. The target dies if the disease reduces its hit point maximum to 0. This reduction to the target's hit point maximum lasts until the disease is cured.</span> <span ng-if=attack.paralysis>If the target is a creature, it must succeed on a DC <span ng-bind=stats.attr.saveDCs.constitution></span> Constitution saving or be paralyzed for <span ng-bind>attack.paralysis.duration</span>. The target can repeat the saving throw at the end of each of its turns, ending the effect on itself on a success.</span> <span ng-if=attack.special><span ng-bind=attack.special></span>.</span>
                    </div>
                    <div class=action ng-repeat="action in stats.actions">
                        <h4><span ng-bind=action.name></span><span ng-if=action.recharge>&nbsp;(<span ng-bind=action.recharge></span>)</span>.</h4>&nbsp;<span class=action-description ng-bind-html=toTrustedHTML(action.description)></span>.</div>
                </div>
            </div>
            <div class=bar></div>
        </div>
    </div>
</body>

</html>